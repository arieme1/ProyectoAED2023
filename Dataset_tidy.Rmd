---
title: "ProyectoAED"
author: "Alex Riera Merino"
date: "2023-11-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
library(tidyverse)
library(dplyr)
```

<<<<<<< HEAD

```{r}
estaciones<-read_delim("./data/Maestro_Climatologico_2022.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE,show_col_types = FALSE)
```


```{r}
carpeta_base<-"./data/Variables/"

años<-2016:2022

lista_dataframes <- list()

for (año in años){
  
ruta_carpeta<-file.path(carpeta_base, as.character(año))
archivos_climaticos <- list.files(ruta_carpeta,pattern = ".*.csv")


df_año<-data.frame(Indicativo = character(0), Meses = character(0), Valores= numeric(0))


for (archivo in archivos_climaticos) {
  
  ruta_completa_archivo<-file.path(ruta_carpeta,archivo)
  variable <-read_delim(ruta_completa_archivo, delim = ";", escape_double = FALSE,
                          trim_ws=TRUE, show_col_types=FALSE)
  prefijo <- substr(archivo, 1, nchar(archivo) - 9)

  df_variable <- variable %>%
      pivot_longer(col = -c(Indicativo), names_to = "Meses", 
                   values_to = prefijo) 
  
    if (archivo == archivos_climaticos[1]) {
        
      df_año <- df_variable
      
     } else {
       
      df_año <- left_join(df_año,df_variable, by=join_by("Indicativo","Meses"))
     }
  
}
  lista_dataframes[[as.character(año)]] <- df_año
  assign(paste0("df_", año), df_año, envir = .GlobalEnv)
  carpeta<-"./data/"
  nombre_archivo <- file.path(carpeta, paste0("dataset_",año,".csv"))
  write.csv(df_año, nombre_archivo, row.names = FALSE)
}

rm(df_variable,variable,df_año)
```


=======
```{r}
dataset1 <- read_delim("./data/Variables/2022/HR_2022.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
dataset2 <- read_delim("./data/Maestro_Climatologico_2022.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

ruta_carpeta<-"./data/Variables/2022"

archivos_climaticos <- list.files(ruta_carpeta,pattern = ".*.csv")

nuevo_dataset <- dataset1 %>%
   pivot_longer(col = -c(Indicativo), names_to = "Meses", values_to = "Valores_HR")

dataset3 <- read_delim("./data/Variables/2022/INSO_2022.csv", 
     delim = ";", escape_double = FALSE, trim_ws = TRUE)
nuevo_dataset_2 <- dataset3 %>%
  pivot_longer(col = -c(Indicativo), names_to = "Meses", values_to = "Valores_IN")
nuevo_dataset_2 <- nuevo_dataset_2[1:nrow(nuevo_dataset),]


dataset_final <- left_join(nuevo_dataset,nuevo_dataset_2)


 
dataset4 <- read_delim("./data/Variables/2022/P_MES_2022.csv", 
     delim = ";", escape_double = FALSE, trim_ws = TRUE)
nuevo_dataset_3 <- dataset4 %>%
  pivot_longer(col = -c(Indicativo), names_to = "Meses", values_to = "Valores_PMES") 

nuevo_dataset_3 <- nuevo_dataset_3[1:nrow(nuevo_dataset),]

dataset_final <- left_join(dataset_final,nuevo_dataset_3)

dataset5 <- read_delim("./data/Variables/2022/TM_MAX_2022.csv", 
     delim = ";", escape_double = FALSE, trim_ws = TRUE)
nuevo_dataset_4 <- dataset5 %>%
   pivot_longer(col = -c(Indicativo), names_to = "Meses", values_to = "Valores_TMAX")

nuevo_dataset_4 <- nuevo_dataset_4[1:nrow(nuevo_dataset),]

dataset_final <- left_join(dataset_final,nuevo_dataset_4)

dataset6 <- read_delim("./data/Variables/2022/TM_MES_2022.csv", 
     delim = ";", escape_double = FALSE, trim_ws = TRUE)
nuevo_dataset_5 <- dataset6 %>%
   pivot_longer(col = -c(Indicativo), names_to = "Meses", values_to = "Valores_TMES")

nuevo_dataset_5 <- nuevo_dataset_5[1:nrow(nuevo_dataset),]

dataset_final <- left_join(dataset_final,nuevo_dataset_5)
 
dataset7 <- read_delim("./data/Variables/2022/TM_MIN_2022.csv", 
     delim = ";", escape_double = FALSE, trim_ws = TRUE)
nuevo_dataset_6 <- dataset7 %>%
   pivot_longer(col = -c(Indicativo), names_to = "Meses", values_to = "Valores_TMIN")

nuevo_dataset_6 <- nuevo_dataset_6[1:nrow(nuevo_dataset),]

dataset_final <- left_join(dataset_final,nuevo_dataset_6)
 
dataset8 <- read_delim("./data/Variables/2022/W_MED_2022.csv", 
     delim = ";", escape_double = FALSE, trim_ws = TRUE)
nuevo_dataset_7 <- dataset8 %>%
   pivot_longer(col = -c(Indicativo), names_to = "Meses", values_to = "Valores_WM")

nuevo_dataset_7 <- nuevo_dataset_7[1:nrow(nuevo_dataset),]

dataset_final <- left_join(dataset_final,nuevo_dataset_7)

```




>>>>>>> f853f921ad36fcc36c7ed7c6345592e2a109c4d3
